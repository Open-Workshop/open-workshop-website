{% extends 'html-partials/standart.html' %}
{% block content %}
  <main class="user settings">
    {% if not user_access.any %}
    <h1 style="text-align: center;">
      {% if user_access.my %}–ü–æ—Ö–æ–∂–µ –∫ –≤–∞–º –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏ –∏ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è :({% endif %}
      {% if not user_access.my %}–≠—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å —É–¥–∞–ª–µ–Ω!{% endif %}
    </h1>
    {% endif %}

    {% if (not user_data.delete_user and (user_access.any or user_access.my)) or (user_data.delete_user and user_access.admin) %}
    <pager variants="profile, delete-account, rights, integrate">
      <label>–ù–∞–≤–∏–≥–∞—Ü–∏—è</label>
      {% if not user_data.delete_user %}
      <button id="page-profile-button" active-in-variant="page-save-button" variant="profile" onclick="Pager.change(this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
      {% endif %}
      {% if user_access.my or user_access.admin %}
      {% if not user_data.delete_user %}
      <button id="page-integrate-button" disabled-in-variant="page-save-button" variant="integrate" onclick="Pager.change(this)">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</button>
      {% endif %}
      <button id="page-rights-button" active-in-variant="page-save-button" variant="rights" onclick="Pager.change(this)">–ü—Ä–∞–≤–∞</button>
      {% endif %}

      {% if user_access.my %}
      <button id="page-delete-account-button" disabled-in-variant="page-save-button" variant="delete-account" onclick="Pager.change(this)">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
      {% endif %}

      <button id="page-save-button" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </pager>
    <hr id="mobile-hr-user-settings">
    <div style="width: 100%;">
      {% if not user_data.delete_user %}
      <div id="page-profile" class="user-container-settings">
        <div class="user-left-bar">
          <div class="wrapper" style="width: 100%; max-width: 150pt;">
            <div class="user-avatar-box">
                <img startdata="{{ user_data.general.avatar_url }}" src="{{ user_data.general.avatar_url }}" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" id="user-avatar-img" style="width: 100%;" class="user-avatar{% if user_access.avatar %} user-avatar-e{% endif %}"{% if user_access.avatar %} onclick="document.getElementById('file-select-avatar').click();"{% endif %}>
  
                {% if user_access.avatar %}
                <img class="user-edit-icon user-edit-icon-e" src="/assets/images/icon-edit.svg" alt="–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä">
                {% endif %}
                <input type="file" accept=".png, .jpg" style="display: none;" id="file-select-avatar">
            </div>
            {% if user_access.avatar %}
            <div style="cursor: pointer; height: auto;" class="independence-mods-selector" onclick="document.getElementById('reset-avatar-checkbox').click();">
              <input class="input-checkbox" style="margin: 4pt;" onchange="" id="reset-avatar-checkbox" type="checkbox">
              <label style="margin-left: 2pt; cursor: pointer; margin-top: 1pt;">–°–±—Ä–æ—Å–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</label>
            </div>
            {% endif %}
            
            {% if user_access.mute %}
            <div class="medium-6 columns">
              <input style="width: 100%;" id="mute-datetime" type="datetime-local"{% if user_data.general.mute %} startdata="{{ user_data.general.mute_js }}" value="{{ user_data.general.mute_js }}"{% endif %} class='date'>
            </div>
            <style>
              input.date{
                margin-top: 5pt;
                border-radius: 10px;
                height: auto;
                transition: all ease 200ms;
                box-shadow: 0px 0px 3px 3px #4a4a4a;
                background: #313131;
                color: white;
              }

              input.date:hover{
                box-shadow:0px 0px 5px 5px rgb(165, 165, 165);
              }
            </style>
            {% endif %}

            <script>
              {% if user_access.mute %}
              document.getElementById('mute-datetime').min = new Date().toLocaleString("sv-SE", {
                  year: "numeric",
                  month: "2-digit",
                  day: "2-digit",
                  hour: "2-digit",
                  minute: "2-digit",
                  second: "2-digit"
              }).replace(" ", "T");
              {% endif %}

              const input = document.getElementById('file-select-avatar');
              const img = document.getElementById('user-avatar-img');

              input.addEventListener('change', function() {
                const file = input.files[0];

                //Initiate the JavaScript Image object.
                const reader = new FileReader();

                //Read the contents of Image File.
                reader.readAsDataURL(file);
                reader.onload = function (e) {

                  var image = new Image();

                  //Set the Base64 string return from FileReader as source.
                  image.src = e.target.result;

                  //Validate the File Height and Width.
                  image.onload = function () {
                    var height = this.height;
                    var width = this.width;
                    
                    if (Math.abs(width / height - 1) > 0.05) {
                      input.value = '';  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª, –µ—Å–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                      img.src = img.getAttribute("startdata")
                      banner_error_a = {
                        title: '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–≤–∞—Ç–∞—Ä!',
                        text: '–ê–≤–∞—Ç–∞—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º!',
                        theme: 'warning',
                        autohide: true,
                        interval: 6000
                      };

                      new Toast(banner_error_a)
                    } else if (width < 60 || height < 60) {     // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ < 60px
                      input.value = '';  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª, –µ—Å–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                      img.src = img.getAttribute("startdata")
                      banner_error_a = {
                        title: '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–≤–∞—Ç–∞—Ä!',
                        text: '–°–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞!',
                        theme: 'warning',
                        autohide: true,
                        interval: 6000
                      };

                      new Toast(banner_error_a)
                    } else if (file.size > 2 * 1024 * 1024) {
                      input.value = '';  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª, –µ—Å–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                      img.src = img.getAttribute("startdata")
                      banner_error_a = {
                        title: '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–≤–∞—Ç–∞—Ä!',
                        text: '–ê–≤–∞—Ç–∞—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç—è–∂–µ–ª–µ–µ 2–ú–ë!',
                        theme: 'warning',
                        autohide: true,
                        interval: 6000
                      };

                      new Toast(banner_error_a)
                    } else {
                      img.src = e.target.result;
                    }
                  };
                }
              });
            </script>
          </div>
        </div>

        <div style="width: 100%">
          <h1 id="mod-name-title" style="padding-bottom: 3pt; padding-bottom: 3pt; display: flex; justify-content: space-between; align-items: center;" translate="no">
            <div {% if user_access.grade or user_access.username %}style="display: flex; align-items: center;"{% endif %}>
              {% if not user_access.username %}
              {{ user_data.general.username }}
              {% endif %}

              {% if user_access.username %}
              <input class="edit-username" maxlength="18" startdata="{{ user_data.general.username }}" id="username" value="{{ user_data.general.username }}" name="username" oninput="usernameEditEvent()">
              {% endif %}

              {% if user_access.grade %}
              <input id="grade" placeholder="–ó–≤–∞–Ω–∏–µ..." maxlength="18" startdata="{{ user_data.general.grade }}" type="text" title="–ó–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∑–∞—Å–ª—É–≥–∏)" class="tag-link-red grade-edit" value="{{ user_data.general.grade }}" oninput="gradeEditEvent()">
              {% endif %}
              {% if not user_access.grade and user_data.general.grade|length >0 %}
              <a title="–ó–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∑–∞—Å–ª—É–≥–∏)" style="padding-top: 0; padding-bottom: 0;" class="tag-link-red" translate="no">{{ user_data.general.grade }}</a>
              {% endif %}

              <script>
                const usernameElement = document.getElementById('username');

                usernameEditEvent()
                function usernameEditEvent() {
                  if (usernameElement) {
                    const myText = usernameElement.value;

                    if (myText.length >= 18 || myText.length <= 1) {
                      usernameElement.classList.add('limit');
                    } else {
                      usernameElement.classList.remove('limit')
                    }

                    usernameElement.style.width = 0;
                    usernameElement.style.width = usernameElement.scrollWidth+5 + "px";
                  }
                }
                
                const gradeElement = document.getElementById('grade');

                gradeEditEvent()
                function gradeEditEvent() {
                  if (gradeElement) {
                    const myText = gradeElement.value;

                    gradeElement.style.width = 0;
                    gradeElement.style.width = gradeElement.scrollWidth+5 + "px";
                  }
                }
              </script>
            </div>
          </h1>
          <h4 id="mod-tags-title">
              <a title="–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏" id="date_creation_a_tag" datejs="" class="tag-link" translate="no">üìù{{ user_data.general.registration_date }}</a>
              <div title="–†–µ–ø—É—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ user_data.general.reputation }}" class="tag-link-blue" translate="no">
                {% if user_data.general.reputation < 0 %}üëø{% endif %}
                {% if user_data.general.reputation > 0 %}üòá{% endif %}
                <a class="tag-link" translate="no">{{ user_data.general.reputation }}</a>
                {% if user_data.general.reputation == 0 %}üëÄ{% endif %}
              </div>

              {% if user_data.general.author_mods > 0 %}
              <a title="–ê–≤—Ç–æ—Ä {{ user_data.general.author_mods }} –º–æ–¥–æ–≤" class="tag-link-orange" translate="no">üì§{{ user_data.general.author_mods }}</a>
              {% endif %}

              {% if user_data.general.comments > 0 %}
              <a title="–û—Å—Ç–∞–≤–∏–ª {{ user_data.general.comments }} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤" class="tag-link-orange" translate="no">‚úèÔ∏è{{ user_data.general.comments }}</a>
              {% endif %}
          </h4>

          {% if user_access.about %}
            {% with limit=512, placeholder='–û–±–æ –º–Ω–µ...', init_text=(user_data.general.about if user_data.general.about_enable else "") %}
              {% include 'html-partials/desc-edit.html' %}
            {% endwith %}
          {% endif %}
          {% if not user_access.about and user_data.general.about_enable %}
          <article id="mod-description">{{ user_data.general.about }}</article>
          {% endif %}
        </div>
      </div>
      {% endif %}
      {% if user_access.my or user_access.admin %}
        {% if not user_data.delete_user %}
        <div id="page-integrate" class="user-container-settings">
          <button class="service" {% if not user_access.my %}disabled{% endif %} {% if user_access.my and not user_data.private.yandex %}onclick="serviceConnect('/api/accounts/authorization/yandex/link')"{% endif %}{% if user_access.my and user_data.private.yandex %}onclick="serviceDisconnect('yandex')"{% endif %}>
            <img src="/assets/images/webp/yandex.webp" alt="Yandex logo" onerror="handlerImgErrorLoad(this)">
            
            <p>
              {% if user_access.my %}
                {% if user_data.private.yandex %}–û—Ç–≤—è–∑–∞—Ç—å{% endif %}
                {% if not user_data.private.yandex %}–ü—Ä–∏–≤—è–∑–∞—Ç—å{% endif %}
              {% endif %}
              {% if not user_access.my %}
                {% if not user_data.private.yandex %}–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω{% endif %}
                {% if user_data.private.yandex %}–ü–æ–¥–∫–ª—é—á–µ–Ω{% endif %}
              {% endif %}
            </p>
          </button>
          <button class="service" {% if not user_access.my %}disabled{% endif %} {% if user_access.my and not user_data.private.google %}onclick="serviceConnect('/api/accounts/authorization/google/link')"{% endif %}{% if user_access.my and user_data.private.google %}onclick="serviceDisconnect('google')"{% endif %}>
            <img src="/assets/images/webp/google.webp" alt="Google logo" onerror="handlerImgErrorLoad(this)">
            
            <p>
              {% if user_access.my %}
                {% if user_data.private.google %}–û—Ç–≤—è–∑–∞—Ç—å{% endif %}
                {% if not user_data.private.google %}–ü—Ä–∏–≤—è–∑–∞—Ç—å{% endif %}
              {% endif %}
              {% if not user_access.my %}
                {% if not user_data.private.google %}–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω{% endif %}
                {% if user_data.private.google %}–ü–æ–¥–∫–ª—é—á–µ–Ω{% endif %}
              {% endif %}
            </p>
          </button>
        </div>
        {% endif %}
        <div id="page-rights" style="flex-direction: column;" class="user-container-settings rights-cont">
          <div>
            <input type="checkbox" id="checkbox-rights-edit-admin" {% if user_data.rights.admin %}startdata checked{% endif %} disabled />
            <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</p>
          </div>
          <hr>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-write_comments" {% if user_data.rights.write_comments %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ü–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</p>
          </div>
          <hr>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-set_reactions" {% if user_data.rights.set_reactions %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–û—Å—Ç–∞–≤–ª—è—Ç—å —Ä–µ–∞–∫—Ü–∏–∏</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-create_reactions" {% if user_data.rights.create_reactions %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–°–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∞–∫—Ü–∏–∏</p>
          </div>
          <hr>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-publish_mods" {% if user_data.rights.publish_mods %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –º–æ–¥—ã</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-change_authorship_mods" {% if user_data.rights.change_authorship_mods %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ò–∑–º–µ–Ω—è—Ç—å –∞–≤—Ç–æ—Ä—Å—Ç–≤–æ –º–æ–¥–æ–≤</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-change_self_mods" {% if user_data.rights.change_self_mods %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ò–∑–º–µ–Ω—è—Ç—å —Å–≤–æ–∏ –º–æ–¥—ã</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-change_mods" {% if user_data.rights.change_mods %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ò–∑–º–µ–Ω—è—Ç—å —á—É–∂–∏–µ –º–æ–¥—ã</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-delete_self_mods" {% if user_data.rights.delete_self_mods %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–£–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ –º–æ–¥—ã</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-delete_mods" {% if user_data.rights.delete_mods %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–£–¥–∞–ª—è—Ç—å —á—É–∂–∏–µ –º–æ–¥—ã</p>
          </div>
          <hr>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-mute_users" {% if user_data.rights.mute_users %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ú—É—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
          </div>
          <hr>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-create_forums" {% if user_data.rights.create_forums %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–°–æ–∑–¥–∞–≤–∞—Ç—å —Ñ–æ—Ä—É–º—ã</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-change_authorship_forums" {% if user_data.rights.change_authorship_forums %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ò–∑–º–µ–Ω—è—Ç—å –∞–≤—Ç–æ—Ä—Å—Ç–≤–æ —Ñ–æ—Ä—É–º–æ–≤</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-change_self_forums" {% if user_data.rights.change_self_forums %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ò–∑–º–µ–Ω—è—Ç—å —Å–≤–æ–∏ —Ñ–æ—Ä—É–º—ã</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-change_forums" {% if user_data.rights.change_forums %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ò–∑–º–µ–Ω—è—Ç—å —á—É–∂–∏–µ —Ñ–æ—Ä—É–º—ã</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-delete_self_forums" {% if user_data.rights.delete_self_forums %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–£–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ —Ñ–æ—Ä—É–º—ã</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-delete_forums" {% if user_data.rights.delete_forums %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–£–¥–∞–ª—è—Ç—å —á—É–∂–∏–µ —Ñ–æ—Ä—É–º—ã</p>
          </div>
          <hr>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-change_username" {% if user_data.rights.change_username %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ò–∑–º–µ–Ω—è—Ç—å –Ω–∏–∫–Ω–µ–π–º</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-change_about" {% if user_data.rights.change_about %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ò–∑–º–µ–Ω—è—Ç—å "–æ–±–æ –º–Ω–µ"</p>
          </div>
          <div>
            <input type="checkbox" id="checkbox-rights-edit-change_avatar" {% if user_data.rights.change_avatar %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ú–µ–Ω—è—Ç—å –∞–≤–∞—Ç–∞—Ä</p>
          </div>
          <hr>
          <div>
            <input type="checkbox" id="checkbox-rights-edit_vote_for_reputation" {% if user_data.rights.vote_for_reputation %}startdata checked{% endif %} {% if not user_access.admin %}disabled{% endif %} />
            <p>–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏—é</p>
          </div>
        </div>
      {% endif %}
      {% if user_access.my %}
      <div id="page-delete-account" class="user-container-settings">
        <div>
          <input maxlength="18" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º" oninput="usernameDeleteEditEvent()" startdata="{{ user_data.general.username }}" id="username-access-delete">
          
          <div class="outline-container">
            <input type="checkbox" id="checkbox-delete-confirm" onchange="activateDeleteButton()">
            <label>–Ø –æ—Å–æ–∑–Ω–∞—é –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∏—Å–∫–∏</label>
          </div>
          
          <button onclick="commitToDelete()" disabled>–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        </div>
        <script>
          const usernameDeleteElement = document.getElementById('username-access-delete');

          function activateDeleteButton() {
            const $checkboxConfirm = $('input#checkbox-delete-confirm');
            $('#page-delete-account > div > button').prop('disabled', !$checkboxConfirm.is(':checked'));
          }

          usernameDeleteEditEvent()
          function usernameDeleteEditEvent() {
            console.log(usernameDeleteElement)
            if (usernameDeleteElement) {
              const myText = usernameDeleteElement.value;

              if (usernameDeleteElement.getAttribute("startdata") != myText) {
                console.log("ADDDDDDD")
                usernameDeleteElement.classList.add('limit');
              } else {
                console.log("REMOVEEEEE")
                usernameDeleteElement.classList.remove('limit')
              }
            }
          }

          function commitToDelete() {
            if (usernameDeleteElement) {
              const myText = usernameDeleteElement.value;

              if (usernameDeleteElement.getAttribute("startdata") != myText) {
                banner_error_a = {
                  title: '–û—à–∏–±–∫–∞',
                  text: '–†–∞–¥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –Ω–∏–∫–Ω–µ–π–º –≤ –ø–æ–ª–µ!',
                  theme: 'warning',
                  autohide: true,
                  interval: 6000
                };

                new Toast(banner_error_a);
              } else {
                fetch('/api/accounts/authorization/delete', {method: 'POST'}).then(response => {
                  location.reload();
                })
              }
            }
          }
        </script>
      </div>
      {% endif %}
    </div>
    
    <script>
      function saveProfile() {
        let data = {}

        let tofetch = false
        let url = '/api/accounts/profile/edit/{{ user_data.general.id }}?'
        let formData = new FormData();

        const $username = $('#username');
        if ($username.val() != $username.attr("startdata")) {
          formData.append('username', $username.val());
          tofetch = true
        }
        const $grade = $('#grade');
        if ($grade.val() != $grade.attr("startdata")) {
          formData.append('grade', $grade.val());
          tofetch = true
        }
        const $about = $("#page-profile").find("textarea.editing");
        if ($about.val() != $about.attr("startdata")) {
          formData.append('about', $about.val());
          tofetch = true
        }
        const $input = $("#file-select-avatar");
        if ($input.get(0).files.length > 0) {
          formData.append('avatar', $input.get(0).files[0]);
          tofetch = true
        } else {
          formData.append('avatar', '');
        }

        const $emptyAvatar = $("#reset-avatar-checkbox");
        if ($emptyAvatar.is(":checked")) {
          formData.append('empty_avatar', true);
          tofetch = true
        }
        const $mute = $('#mute-datetime');
        if (($mute.attr("startdata") && $mute.val() != $mute.attr("startdata")) || ($mute.val() && !$mute.attr("startdata"))) {
          formData.append('mute', $mute.val());
          tofetch = true
        }

        console.log(url)

        if (tofetch) {
          fetch(url, {
            method: 'POST',
            body: formData
          }).then(response => {
            if (response.status === 202) {
              console.log('–ö–æ–¥ –æ—Ç–≤–µ—Ç–∞ —Ä–∞–≤–µ–Ω 202!');
            } else {
              console.log('–ö–æ–¥ –æ—Ç–≤–µ—Ç–∞ –Ω–µ —Ä–∞–≤–µ–Ω 202');
              response.text().then(text => {
                banner_error_a = {
                  title: '–ü—Ä–æ—Ñ–∏–ª—å',
                  text: text.substring(1, text.length - 1),
                  theme: 'warning',
                  autohide: true,
                  interval: 6000
                };

                new Toast(banner_error_a);
              });
            }
          }).catch(error => {
            console.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞: ' + error);
            banner_error_a = {
              title: '–ü—Ä–æ—Ñ–∏–ª—å',
              text: '–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞...',
              theme: 'danger',
              autohide: true,
              interval: 6000
            };

          new Toast(banner_error_a)
          });
        }



        var tofetchTWO = false
        formData = new FormData();

        // –ó–∞–ø—Ä–æ—Å –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤
        url = '/api/accounts/edit/profile/rights?user_id={{ user_data.general.id }}&'
        function addRight(nameCheckbox) {
          const checkbox = document.getElementById('checkbox-rights-edit-'+nameCheckbox);

          console.log(checkbox)
          if (checkbox && checkbox.hasAttribute('startdata') != checkbox.checked) {
            tofetchTWO = true
            formData.append(nameCheckbox, checkbox.checked);
          }
        }
        
        const rightsList = [
          'admin',
          'write_comments',
          'set_reactions',
          'create_reactions',
          'mute_users',
          'publish_mods',
          'change_authorship_mods',
          'change_self_mods',
          'change_mods',
          'delete_self_mods',
          'delete_mods',
          'create_forums',
          'change_authorship_forums',
          'change_self_forums',
          'change_forums',
          'delete_self_forums',
          'delete_forums',
          'change_username',
          'change_about',
          'change_avatar',
          'vote_for_reputation'
        ]
        for (i in rightsList) {
          addRight(rightsList[i])
        }

        if (tofetchTWO) {
          fetch(url, {
            method: 'POST',
            body: formData
          }).then(response => {
            if (response.status === 202) {
              console.log('–ö–æ–¥ –æ—Ç–≤–µ—Ç–∞ —Ä–∞–≤–µ–Ω 202!');
            } else {
              console.log('–ö–æ–¥ –æ—Ç–≤–µ—Ç–∞ –Ω–µ —Ä–∞–≤–µ–Ω 202');
              response.text().then(text => {
                banner_error_a = {
                  title: '–ü—Ä–∞–≤–∞',
                  text: text.substring(1, text.length - 1),
                  theme: 'warning',
                  autohide: true,
                  interval: 6000
                };

                new Toast(banner_error_a);
              });
            }
          }).catch(error => {
            console.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞: ' + error);
            banner_error_a = {
              title: '–ü—Ä–∞–≤–∞',
              text: '–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞...',
              theme: 'danger',
              autohide: true,
              interval: 6000
            };

          new Toast(banner_error_a)
          });
        }
        
        if (tofetch || tofetchTWO) {
          location.reload();
        } else {
          banner_error_a = {
            title: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ',
            text: '–í—ã –Ω–µ –≤–Ω–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å',
            theme: 'warning',
            autohide: true,
            interval: 6000
          };

          new Toast(banner_error_a);
        }
      }
    </script>
    {% endif %}
  </main>

  <script src="/assets/scripts/vendors/pager-logic.js"></script>

  <script>
    Pager.updateSelect.call(document.querySelector('#page-profile-button'))
    window.addEventListener('popstate', function(event) {
      Pager.updateSelect.call(document.querySelector('#page-profile-button'))
    });
  </script>
{% endblock %}

{% block title %}
{{ user_data.general.username }} - user settings
{% endblock %}

{% block description %}
–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user_data.general.username }} –≤ Open Workshop
{% endblock %}


{% block metaimage %}
{{ user_data.general.avatar_url }}
{% endblock %}

